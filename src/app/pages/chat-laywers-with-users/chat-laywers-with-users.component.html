<app-nav-sidebar></app-nav-sidebar>
<!--! details -->
<aside id="sidebar-multi-level-sidebar"
    class="fixed bottom-0 top-0 left-20 z-40 w-80 mx-2 my-6 transition-transform -translate-x-full sm:translate-x-0"
    aria-label="Sidebar">
    <div class="h-full px-3 py-4  backdrop-blur-lg bg-gray-100/10 rounded-3xl rounded-l-none ">
        <h2 class="text-3xl font-medium  text-white mx-3 my-6">Users</h2>
        <div class=" mt-10 mb-10 flex items-center justify-between flex-col ">
            <div>
                @if (isLoadingChats) {
                  <div class="flex justify-center items-center my-8">
                    <span class="loader"></span>
                  </div>
                }
                @else {
                  @for (chat of chats; track chat) {
                    <div class="lawyer flex items-center justify-between mb-6 rounded-2xl bg-white p-4 shadow-2xl cursor-pointer"
                         (click)="openChat(chat)">
                        <div class="relative w-10 h-10 overflow-hidden bg-gray-400 rounded-full ">
                            <svg class=" absolute w-8 h-8 bottom-0 right-1" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="det mx-3">
                            <div class="flex justify-between items-center">
                                <h5 class="text-lg font-semibold">{{ chat.participant_name }}</h5>
                            </div>
                            <p class="font-medium text-sm">{{ chat.last_message || 'No messages yet' }}</p>
                        </div>
                        <p class="mb-auto text-xs font-medium">{{ chat.last_message_time || '' }}</p>
                    </div>
                  }
                }
            </div>
        </div>
        <div 
        class="contact absolute bottom-0 left-0 right-0  text-center">
            <h3 routerLink="/ContactUs" routerLinkActive="bg-red-800"
             class="text-xl font-medium   bg-slate-950/20 text-white px-4 py-4 rounded-br-3xl  cursor-pointer hover:bg-red-800/30 hover:scale-110 hover:shadow-2xl/50 hover:-translate-y-1 hover:rounded-r-3xl transition-all duration-300  ">Contact-Us</h3>
        </div>
    </div>
</aside>
<!--! details -->
<!--! chat -->
<div class="p-4 sm:ml-80 ">
    @if (selectedUser && currentChatId) {
    <div class="chat-box mx-40 mt-5 mb-12 relative">
        <div class="title flex items-center justify-between border-b border-gray-300 px-2 py-4 ">
            <div class="flex items-center">
                <div class="relative w-10 h-10 overflow-hidden bg-gray-400 rounded-full ">
                    <svg class=" absolute w-8 h-8 bottom-0 right-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
                <h1 class="text-2xl ms-2 font-semibold">{{ selectedUser.first_name }}</h1>
            </div>
            <div class="icons bg-gray-50">
                <span routerLink="/profile"
                    class="hover:rounded-full hover:shadow-2xl/50 hover:bg-white py-4 px-1 transition-all duration-300">
                    <i class="fa-solid fa-pen text-xl text-slate-950 px-4 "></i>
                </span>
                <span
                    class="hover:rounded-full hover:shadow-2xl/50 hover:bg-white py-4 px-1 transition-all duration-300 ms-2">
                    <i class="fa-solid fa-gear text-xl text-slate-950 px-4 "></i>
                </span>
            </div>
        </div>
        <div class="p-0 font-medium backdrop-blur-lg bg-slate-950/40 rounded-3xl shadow-2xl/20 h-[80vh] my-6 relative">
            <div class="messages overflow-y-auto pb-40 px-10 pt-10" style="height: calc(100% - 90px);">
                @if (messages.length === 0) {
                  <div class="text-gray-400 text-center mt-32">No messages yet</div>
                }
                @for (msg of messages; track msg) {
                  <div 
                    [ngClass]="msg.is_user ? 'request rounded-tr-none bg-red-900/50 text-white ms-auto w-[35%]' : 'response rounded-bl-none bg-gray-900/30 border border-gray-200 text-white w-[45%]'"
                    class="p-6 rounded-2xl shadow-2xl/20 mb-2">
                    <p>{{ msg.content }}</p>
                  </div>
                }
                <!-- Typing indicator as AI message, just above the input -->
                <div *ngIf="isTyping" class="flex justify-start mb-1">
                  <div class="bg-gray-200 text-slate-900 rounded-2xl px-4 py-2 max-w-[70%] flex items-center typing-indicator">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                </div>
            </div>
            <div class="input absolute bottom-0 left-0 right-0 px-10 py-5 backdrop-blur-2xl">
                <form class="flex items-center mx-auto" (ngSubmit)="sendMessageFromUI()">
                    <label for="voice-search" class="sr-only">Search</label>
                    <div class="relative w-full">
                        <input type="text" id="voice-search"
                            class="backdrop-blur-lg bg-gray-100/10 border border-gray-100/10 text-white text-sm rounded-3xl block w-full ps-10 p-5"
                            placeholder="write your message..." required 
                            [(ngModel)]="newMessage" name="newMessage" />
                        <button type="button" class="absolute inset-y-0 end-0 flex items-center pe-3">
                            <svg class="w-4 h-4 text-gray-400 hover:text-white"
                                aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 7v3a5.006 5.006 0 0 1-5 5H6a5.006 5.006 0 0 1-5-5V7m7 9v3m-3 0h6M7 1h2a3 3 0 0 1 3 3v5a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3Z" />
                            </svg>
                        </button>
                    </div>
                    <button type="submit"
                        class="inline-flex items-center ms-2 text-sm font-medium text-white bg-gray-900/10 border border-gray-200 rounded-3xl p-5 shadow-2xl/30 hover:bg-red-800/30 hover:scale-105 transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            class="h-5 w-5 text-white">
                            <path
                                d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>
    }
</div>
<!--! chat -->
<div id="vanta-bg"></div>